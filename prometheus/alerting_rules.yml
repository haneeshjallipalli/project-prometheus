groups:
- name: demo-service-alerts
  rules:
  - alert: container_cpu_usage_high
    expr: |
      sum by (path, instance, job) (rate(container_cpu_user_seconds_total{}[1m])) / sum by (path, instance, job) (rate(container_cpu_user_seconds_total{}[1m])) * 100 > 0.5
    for: 30s
    labels:
      severity: critical
    annotations:
      description: "The 5xx error rate for path {{$labels.path}} on {{$labels.instance}} is {{$value}}%."
  - alert: container_memory_usage_high
    expr: |
      sum by (path, instance, job) (rate(container_memory_usage_bytes{}[1m])) / sum by (path, instance, job) (rate(container_memory_total_inactive_file_bytes{}[1m])) * 0.05 > 1500
    for: 30s
    labels:
      severity: critical
    annotations:
      description: "The 5xx error rate for path {{$labels.path}} on {{$labels.instance}} is {{$value}}%."